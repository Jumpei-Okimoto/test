<!DOCTYPE html>
<html lang="ja">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>é£Ÿå ‚åˆæµã‚¢ãƒ—ãƒª</title>
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }

        body {
            font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, sans-serif;
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            min-height: 100vh;
            display: flex;
            justify-content: center;
            align-items: center;
            padding: 20px;
        }

        .container {
            background: white;
            border-radius: 20px;
            box-shadow: 0 20px 40px rgba(0,0,0,0.1);
            padding: 30px;
            max-width: 400px;
            width: 100%;
            text-align: center;
        }

        .header {
            margin-bottom: 30px;
        }

        .header h1 {
            color: #333;
            font-size: 24px;
            margin-bottom: 10px;
        }

        .header p {
            color: #666;
            font-size: 14px;
        }

        .status {
            background: #f8f9fa;
            border-radius: 12px;
            padding: 20px;
            margin-bottom: 20px;
            border-left: 4px solid #667eea;
        }

        .status h2 {
            color: #333;
            font-size: 18px;
            margin-bottom: 10px;
        }

        .status p {
            color: #666;
            font-size: 14px;
        }

        .button {
            background: linear-gradient(45deg, #667eea, #764ba2);
            color: white;
            border: none;
            border-radius: 12px;
            padding: 15px 25px;
            font-size: 16px;
            font-weight: 600;
            cursor: pointer;
            transition: all 0.3s ease;
            margin: 10px;
            min-width: 200px;
        }

        .button:hover {
            transform: translateY(-2px);
            box-shadow: 0 10px 20px rgba(102, 126, 234, 0.3);
        }

        .button.secondary {
            background: #e9ecef;
            color: #495057;
        }

        .button.secondary:hover {
            background: #dee2e6;
            box-shadow: 0 5px 15px rgba(0,0,0,0.1);
        }

        .qr-container {
            background: white;
            border: 2px solid #e9ecef;
            border-radius: 15px;
            padding: 20px;
            margin: 20px 0;
        }

        .qr-code {
            width: 200px;
            height: 200px;
            background: #f8f9fa;
            border: 2px dashed #dee2e6;
            border-radius: 10px;
            display: flex;
            align-items: center;
            justify-content: center;
            margin: 0 auto 15px;
            font-size: 14px;
            color: #666;
        }

        .qr-actual {
            width: 180px;
            height: 180px;
            background: white;
            border: 1px solid #ddd;
            display: flex;
            align-items: center;
            justify-content: center;
            font-size: 12px;
            color: #333;
        }

        .group-info {
            background: #e3f2fd;
            border-radius: 10px;
            padding: 15px;
            margin: 15px 0;
        }

        .member-list {
            text-align: left;
            margin: 15px 0;
        }

        .member {
            display: flex;
            align-items: center;
            padding: 10px;
            background: #f8f9fa;
            border-radius: 8px;
            margin: 5px 0;
        }

        .member-status {
            width: 12px;
            height: 12px;
            border-radius: 50%;
            margin-right: 10px;
        }

        .status-waiting { background: #ffc107; }
        .status-ready { background: #28a745; }
        .status-seated { background: #17a2b8; }

        .notification {
            position: fixed;
            top: 20px;
            right: 20px;
            background: #28a745;
            color: white;
            padding: 15px 20px;
            border-radius: 10px;
            box-shadow: 0 5px 15px rgba(0,0,0,0.3);
            transform: translateX(400px);
            transition: transform 0.3s ease;
            z-index: 1000;
        }

        .notification.show {
            transform: translateX(0);
        }

        .seat-info {
            background: #d4edda;
            border: 1px solid #c3e6cb;
            border-radius: 10px;
            padding: 20px;
            margin: 20px 0;
        }

        .seat-info h3 {
            color: #155724;
            margin-bottom: 10px;
        }

        .nfc-simulation {
            background: #fff3cd;
            border: 1px solid #ffeaa7;
            border-radius: 10px;
            padding: 15px;
            margin: 15px 0;
            font-size: 14px;
            color: #856404;
        }

        .hidden {
            display: none;
        }

        .input-group {
            margin: 15px 0;
        }

        .input-group input {
            width: 100%;
            padding: 12px;
            border: 2px solid #e9ecef;
            border-radius: 8px;
            font-size: 16px;
            margin-bottom: 10px;
        }

        .input-group input:focus {
            outline: none;
            border-color: #667eea;
        }
    </style>
</head>
<body>
    <div class="container">
        <div class="header">
            <h1>ğŸ½ï¸ é£Ÿå ‚åˆæµã‚¢ãƒ—ãƒª</h1>
            <p>åŠ¹ç‡çš„ã«ã‚°ãƒ«ãƒ¼ãƒ—ã§é£Ÿäº‹ã‚’æ¥½ã—ã‚‚ã†</p>
        </div>

        <!-- åˆæœŸç”»é¢ -->
        <div id="initial-screen">
            <div class="status">
                <h2>é–‹å§‹æ–¹æ³•ã‚’é¸æŠ</h2>
                <p>æ–°ã—ã„ã‚°ãƒ«ãƒ¼ãƒ—ã‚’ä½œæˆã™ã‚‹ã‹ã€æ—¢å­˜ã®ã‚°ãƒ«ãƒ¼ãƒ—ã«å‚åŠ ã—ã¦ãã ã•ã„</p>
            </div>
            <button class="button" onclick="createGroup()">æ–°ã—ã„ã‚°ãƒ«ãƒ¼ãƒ—ã‚’ä½œæˆ</button>
            <button class="button secondary" onclick="showJoinForm()">ã‚°ãƒ«ãƒ¼ãƒ—ã«å‚åŠ </button>
            
            <div id="join-form" class="hidden">
                <div class="input-group">
                    <input type="text" id="group-code" placeholder="ã‚°ãƒ«ãƒ¼ãƒ—ã‚³ãƒ¼ãƒ‰ã‚’å…¥åŠ›" maxlength="6">
                    <button class="button" onclick="joinGroup()">å‚åŠ </button>
                </div>
            </div>
        </div>

        <!-- NFC ã‚·ãƒŸãƒ¥ãƒ¬ãƒ¼ã‚·ãƒ§ãƒ³ç”»é¢ -->
        <div id="nfc-screen" class="hidden">
            <div class="status">
                <h2>ğŸ“± NFCã‚¿ã‚°ã«ã‚¿ãƒƒãƒ</h2>
                <p>ãƒ¡ãƒ‹ãƒ¥ãƒ¼å‰ã®NFCã‚¿ã‚°ã«ã‚¹ãƒãƒ›ã‚’ã‚¿ãƒƒãƒã—ã¦ãã ã•ã„</p>
            </div>
            <div class="nfc-simulation">
                <p>ğŸ’¡ å®Ÿéš›ã®ç’°å¢ƒã§ã¯ã€NFCã‚¿ã‚°ã«ã‚¿ãƒƒãƒã™ã‚‹ã¨ã‚°ãƒ«ãƒ¼ãƒ—ãŒè‡ªå‹•ä½œæˆã•ã‚Œã¾ã™</p>
            </div>
            <button class="button" onclick="simulateNFC()">NFCã‚¿ãƒƒãƒã‚’ã‚·ãƒŸãƒ¥ãƒ¬ãƒ¼ãƒˆ</button>
        </div>

        <!-- ã‚°ãƒ«ãƒ¼ãƒ—ä½œæˆç”»é¢ -->
        <div id="leader-screen" class="hidden">
            <div class="status">
                <h2>ğŸ‘‘ ã‚°ãƒ«ãƒ¼ãƒ—ãƒªãƒ¼ãƒ€ãƒ¼</h2>
                <p>QRã‚³ãƒ¼ãƒ‰ã‚’ãƒ¡ãƒ³ãƒãƒ¼ã«å…±æœ‰ã—ã¦ãã ã•ã„</p>
            </div>
            <div class="qr-container">
                <div class="qr-code">
                    <div class="qr-actual" id="qr-display">
                        QRã‚³ãƒ¼ãƒ‰ãŒç”Ÿæˆã•ã‚Œã¾ã™
                    </div>
                </div>
                <p><strong>ã‚°ãƒ«ãƒ¼ãƒ—ã‚³ãƒ¼ãƒ‰: <span id="group-code-display"></span></strong></p>
            </div>
            <div class="group-info">
                <h3>ğŸ‘¥ å‚åŠ ãƒ¡ãƒ³ãƒãƒ¼ (<span id="member-count">1</span>äºº)</h3>
                <div class="member-list" id="member-list"></div>
            </div>
            <button class="button secondary" onclick="checkSeatAvailability()">å¸­ã®ç¢ºä¿çŠ¶æ³ã‚’ç¢ºèª</button>
        </div>

        <!-- ãƒ¡ãƒ³ãƒãƒ¼ç”»é¢ -->
        <div id="member-screen" class="hidden">
            <div class="status">
                <h2>ğŸ‘¤ ã‚°ãƒ«ãƒ¼ãƒ—ãƒ¡ãƒ³ãƒãƒ¼</h2>
                <p>æ–™ç†ã‚’å—ã‘å–ã£ãŸã‚‰ã€Œå—ã‘å–ã‚Šå®Œäº†ã€ã‚’æŠ¼ã—ã¦ãã ã•ã„</p>
            </div>
            <div class="group-info">
                <h3>ã‚°ãƒ«ãƒ¼ãƒ—ã‚³ãƒ¼ãƒ‰: <span id="member-group-code"></span></h3>
                <p>ãƒªãƒ¼ãƒ€ãƒ¼: <span id="leader-name"></span></p>
            </div>
            <div class="member-list" id="member-status-list"></div>
            <button class="button" onclick="markReady()" id="ready-button">æ–™ç†å—ã‘å–ã‚Šå®Œäº†</button>
            <button class="button secondary" onclick="secureSeat()" id="seat-button" disabled>å¸­ã‚’ç¢ºä¿ã™ã‚‹</button>
        </div>

        <!-- å¸­ç¢ºä¿ç”»é¢ -->
        <div id="seat-screen" class="hidden">
            <div class="status">
                <h2>ğŸª‘ å¸­ã®ç¢ºä¿</h2>
                <p>ç©ºã„ã¦ã„ã‚‹å¸­ã‚’è¦‹ã¤ã‘ã¦NFCã‚¿ã‚°ã«ã‚¿ãƒƒãƒã—ã¦ãã ã•ã„</p>
            </div>
            <div class="nfc-simulation">
                <select id="seat-select">
                    <option value="">å¸­ã‚’é¸æŠã—ã¦ãã ã•ã„</option>
                    <option value="A-1">ãƒ†ãƒ¼ãƒ–ãƒ«A-1 (çª“éš›)</option>
                    <option value="B-3">ãƒ†ãƒ¼ãƒ–ãƒ«B-3 (ä¸­å¤®)</option>
                    <option value="C-2">ãƒ†ãƒ¼ãƒ–ãƒ«C-2 (å¥¥)</option>
                    <option value="D-4">ãƒ†ãƒ¼ãƒ–ãƒ«D-4 (å…¥å£è¿‘ã)</option>
                </select>
            </div>
            <button class="button" onclick="confirmSeat()">ã“ã®å¸­ã‚’ç¢ºä¿</button>
        </div>

        <!-- åˆæµå®Œäº†ç”»é¢ -->
        <div id="meeting-screen" class="hidden">
            <div class="seat-info">
                <h3>ğŸ‰ åˆæµå ´æ‰€ãŒæ±ºå®šï¼</h3>
                <p><strong>å¸­: <span id="meeting-location"></span></strong></p>
                <p>ç¢ºä¿è€…: <span id="seat-holder"></span></p>
            </div>
            <div class="member-list" id="final-member-list"></div>
            <button class="button secondary" onclick="resetApp()">æ–°ã—ã„ã‚°ãƒ«ãƒ¼ãƒ—ã‚’ä½œæˆ</button>
        </div>
    </div>

    <!-- é€šçŸ¥ -->
    <div id="notification" class="notification">
        <p id="notification-text"></p>
    </div>

    <script>
        // ã‚¢ãƒ—ãƒªã‚±ãƒ¼ã‚·ãƒ§ãƒ³ã®çŠ¶æ…‹ç®¡ç†
        let appState = {
            currentScreen: 'initial',
            userRole: null, // 'leader' or 'member'
            groupCode: null,
            userName: null,
            members: [],
            seatLocation: null,
            seatHolder: null
        };

        // ãƒ¦ãƒ¼ã‚¶ãƒ¼åã‚’ãƒ©ãƒ³ãƒ€ãƒ ç”Ÿæˆï¼ˆå®Ÿéš›ã®å®Ÿè£…ã§ã¯èªè¨¼ã‚·ã‚¹ãƒ†ãƒ ã‚’ä½¿ç”¨ï¼‰
        function generateUserName() {
            const names = ['ç”°ä¸­', 'ä½è—¤', 'éˆ´æœ¨', 'é«˜æ©‹', 'ä¼Šè—¤', 'æ¸¡è¾º', 'å±±æœ¬', 'ä¸­æ‘'];
            const firstNames = ['å¤ªéƒ', 'èŠ±å­', 'æ¬¡éƒ', 'ç¾å’²', 'å¥å¤ª', 'ç”±ç¾', 'ç¿”å¤ª', 'ç¶¾é¦™'];
            return names[Math.floor(Math.random() * names.length)] + 
                   firstNames[Math.floor(Math.random() * firstNames.length)];
        }

        // ã‚°ãƒ«ãƒ¼ãƒ—ã‚³ãƒ¼ãƒ‰ç”Ÿæˆ
        function generateGroupCode() {
            return Math.random().toString(36).substring(2, 8).toUpperCase();
        }

        // ç”»é¢åˆ‡ã‚Šæ›¿ãˆ
        function showScreen(screenId) {
            document.querySelectorAll('.container > div').forEach(div => {
                if (div.id && div.id.includes('-screen')) {
                    div.classList.add('hidden');
                }
            });
            document.getElementById('initial-screen').classList.add('hidden');
            document.getElementById(screenId).classList.remove('hidden');
            appState.currentScreen = screenId;
        }

        // é€šçŸ¥è¡¨ç¤º
        function showNotification(message) {
            const notification = document.getElementById('notification');
            const text = document.getElementById('notification-text');
            text.textContent = message;
            notification.classList.add('show');
            setTimeout(() => {
                notification.classList.remove('show');
            }, 3000);
        }

        // ã‚°ãƒ«ãƒ¼ãƒ—ä½œæˆ
        function createGroup() {
            showScreen('nfc-screen');
        }

        // NFC ã‚·ãƒŸãƒ¥ãƒ¬ãƒ¼ã‚·ãƒ§ãƒ³
        function simulateNFC() {
            appState.userRole = 'leader';
            appState.groupCode = generateGroupCode();
            appState.userName = generateUserName();
            appState.members = [{
                name: appState.userName,
                status: 'waiting',
                isLeader: true
            }];

            showScreen('leader-screen');
            updateLeaderScreen();
            showNotification('NFCã‚¿ãƒƒãƒæˆåŠŸï¼ã‚°ãƒ«ãƒ¼ãƒ—ãŒä½œæˆã•ã‚Œã¾ã—ãŸ');
        }

        // ãƒªãƒ¼ãƒ€ãƒ¼ç”»é¢æ›´æ–°
        function updateLeaderScreen() {
            document.getElementById('group-code-display').textContent = appState.groupCode;
            document.getElementById('member-count').textContent = appState.members.length;
            
            // QRã‚³ãƒ¼ãƒ‰è¡¨ç¤ºï¼ˆå®Ÿéš›ã®å®Ÿè£…ã§ã¯QRã‚³ãƒ¼ãƒ‰ãƒ©ã‚¤ãƒ–ãƒ©ãƒªã‚’ä½¿ç”¨ï¼‰
            document.getElementById('qr-display').innerHTML = `
                <div style="font-size: 10px; line-height: 1.2;">
                    ã‚°ãƒ«ãƒ¼ãƒ—ã‚³ãƒ¼ãƒ‰<br>
                    <strong style="font-size: 16px;">${appState.groupCode}</strong><br>
                    <small>å®Ÿéš›ã¯QRã‚³ãƒ¼ãƒ‰</small>
                </div>
            `;

            updateMemberList('member-list');
        }

        // å‚åŠ ãƒ•ã‚©ãƒ¼ãƒ è¡¨ç¤º
        function showJoinForm() {
            document.getElementById('join-form').classList.remove('hidden');
        }

        // ã‚°ãƒ«ãƒ¼ãƒ—å‚åŠ 
        function joinGroup() {
            const code = document.getElementById('group-code').value.toUpperCase();
            if (code.length !== 6) {
                alert('æ­£ã—ã„ã‚°ãƒ«ãƒ¼ãƒ—ã‚³ãƒ¼ãƒ‰ã‚’å…¥åŠ›ã—ã¦ãã ã•ã„');
                return;
            }

            appState.userRole = 'member';
            appState.groupCode = code;
            appState.userName = generateUserName();
            
            // å®Ÿéš›ã®å®Ÿè£…ã§ã¯ã€ã‚µãƒ¼ãƒãƒ¼ã‹ã‚‰ã‚°ãƒ«ãƒ¼ãƒ—æƒ…å ±ã‚’å–å¾—
            appState.members = [
                { name: 'ç”°ä¸­å¤ªéƒ', status: 'waiting', isLeader: true },
                { name: appState.userName, status: 'waiting', isLeader: false }
            ];

            showScreen('member-screen');
            updateMemberScreen();
            showNotification(`ã‚°ãƒ«ãƒ¼ãƒ— ${code} ã«å‚åŠ ã—ã¾ã—ãŸ`);
        }

        // ãƒ¡ãƒ³ãƒãƒ¼ç”»é¢æ›´æ–°
        function updateMemberScreen() {
            document.getElementById('member-group-code').textContent = appState.groupCode;
            document.getElementById('leader-name').textContent = 
                appState.members.find(m => m.isLeader)?.name || 'ä¸æ˜';
            updateMemberList('member-status-list');
        }

        // ãƒ¡ãƒ³ãƒãƒ¼ãƒªã‚¹ãƒˆæ›´æ–°
        function updateMemberList(containerId) {
            const container = document.getElementById(containerId);
            container.innerHTML = '';
            
            appState.members.forEach(member => {
                const memberDiv = document.createElement('div');
                memberDiv.className = 'member';
                
                const statusClass = `status-${member.status}`;
                const statusText = {
                    'waiting': 'å¾…æ©Ÿä¸­',
                    'ready': 'æº–å‚™å®Œäº†',
                    'seated': 'ç€å¸­æ¸ˆã¿'
                }[member.status];

                memberDiv.innerHTML = `
                    <div class="member-status ${statusClass}"></div>
                    <span>${member.name} ${member.isLeader ? 'ğŸ‘‘' : ''}</span>
                    <span style="margin-left: auto; font-size: 12px; color: #666;">${statusText}</span>
                `;
                container.appendChild(memberDiv);
            });
        }

        // æ–™ç†å—ã‘å–ã‚Šå®Œäº†
        function markReady() {
            const memberIndex = appState.members.findIndex(m => m.name === appState.userName);
            if (memberIndex !== -1) {
                appState.members[memberIndex].status = 'ready';
                document.getElementById('ready-button').disabled = true;
                document.getElementById('ready-button').textContent = 'å—ã‘å–ã‚Šå®Œäº†æ¸ˆã¿';
                document.getElementById('seat-button').disabled = false;
                updateMemberList('member-status-list');
                showNotification('æ–™ç†ã®å—ã‘å–ã‚ŠãŒå®Œäº†ã—ã¾ã—ãŸ');
            }
        }

        // å¸­ç¢ºä¿
        function secureSeat() {
            showScreen('seat-screen');
        }

        // å¸­ç¢ºä¿ç¢ºèª
        function confirmSeat() {
            const selectedSeat = document.getElementById('seat-select').value;
            if (!selectedSeat) {
                alert('å¸­ã‚’é¸æŠã—ã¦ãã ã•ã„');
                return;
            }

            appState.seatLocation = selectedSeat;
            appState.seatHolder = appState.userName;

            // è‡ªåˆ†ã®çŠ¶æ…‹ã‚’ç€å¸­æ¸ˆã¿ã«æ›´æ–°
            const memberIndex = appState.members.findIndex(m => m.name === appState.userName);
            if (memberIndex !== -1) {
                appState.members[memberIndex].status = 'seated';
            }

            showScreen('meeting-screen');
            updateMeetingScreen();
            showNotification(`å¸­ ${selectedSeat} ã‚’ç¢ºä¿ã—ã¾ã—ãŸï¼`);
        }

        // åˆæµç”»é¢æ›´æ–°
        function updateMeetingScreen() {
            document.getElementById('meeting-location').textContent = appState.seatLocation;
            document.getElementById('seat-holder').textContent = appState.seatHolder;
            updateMemberList('final-member-list');
        }

        // å¸­ã®ç¢ºä¿çŠ¶æ³ç¢ºèª
        function checkSeatAvailability() {
            alert('ç¾åœ¨ã®çŠ¶æ³:\næº–å‚™å®Œäº†: ' + 
                appState.members.filter(m => m.status === 'ready').length + 'äºº\n' +
                'ç€å¸­æ¸ˆã¿: ' + appState.members.filter(m => m.status === 'seated').length + 'äºº');
        }

        // ã‚¢ãƒ—ãƒªãƒªã‚»ãƒƒãƒˆ
        function resetApp() {
            appState = {
                currentScreen: 'initial',
                userRole: null,
                groupCode: null,
                userName: null,
                members: [],
                seatLocation: null,
                seatHolder: null
            };
            
            showScreen('initial-screen');
            document.getElementById('join-form').classList.add('hidden');
            document.getElementById('group-code').value = '';
            document.getElementById('ready-button').disabled = false;
            document.getElementById('ready-button').textContent = 'æ–™ç†å—ã‘å–ã‚Šå®Œäº†';
            document.getElementById('seat-button').disabled = true;
        }

        // åˆæœŸåŒ–
        document.addEventListener('DOMContentLoaded', function() {
            showScreen('initial-screen');
        });

        // å®šæœŸçš„ã«ãƒ¡ãƒ³ãƒãƒ¼çŠ¶æ…‹ã‚’æ›´æ–°ï¼ˆå®Ÿéš›ã®å®Ÿè£…ã§ã¯WebSocketã‚„Server-Sent Eventsã‚’ä½¿ç”¨ï¼‰
        setInterval(() => {
            if (appState.members.length > 1) {
                // ãƒ©ãƒ³ãƒ€ãƒ ã«ãƒ¡ãƒ³ãƒãƒ¼ã®çŠ¶æ…‹ã‚’æ›´æ–°ï¼ˆãƒ‡ãƒ¢ãƒ³ã‚¹ãƒˆãƒ¬ãƒ¼ã‚·ãƒ§ãƒ³ç”¨ï¼‰
                appState.members.forEach(member => {
                    if (member.name !== appState.userName && Math.random() < 0.1) {
                        if (member.status === 'waiting') member.status = 'ready';
                        else if (member.status === 'ready' && Math.random() < 0.3) member.status = 'seated';
                    }
                });
                
                if (appState.currentScreen === 'leader-screen') {
                    updateMemberList('member-list');
                } else if (appState.currentScreen === 'member-screen') {
                    updateMemberList('member-status-list');
                }
            }
        }, 3000);
    </script>
</body>
</html>