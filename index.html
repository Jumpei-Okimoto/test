<!DOCTYPE html>
<html lang="ja">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>食堂合流アプリ</title>
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }

        body {
            font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, sans-serif;
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            min-height: 100vh;
            display: flex;
            justify-content: center;
            align-items: center;
            padding: 20px;
        }

        .container {
            background: white;
            border-radius: 20px;
            box-shadow: 0 20px 40px rgba(0,0,0,0.1);
            padding: 30px;
            max-width: 400px;
            width: 100%;
            text-align: center;
        }

        .header {
            margin-bottom: 30px;
        }

        .header h1 {
            color: #333;
            font-size: 24px;
            margin-bottom: 10px;
        }

        .header p {
            color: #666;
            font-size: 14px;
        }

        .status {
            background: #f8f9fa;
            border-radius: 12px;
            padding: 20px;
            margin-bottom: 20px;
            border-left: 4px solid #667eea;
        }

        .status h2 {
            color: #333;
            font-size: 18px;
            margin-bottom: 10px;
        }

        .status p {
            color: #666;
            font-size: 14px;
        }

        .button {
            background: linear-gradient(45deg, #667eea, #764ba2);
            color: white;
            border: none;
            border-radius: 12px;
            padding: 15px 25px;
            font-size: 16px;
            font-weight: 600;
            cursor: pointer;
            transition: all 0.3s ease;
            margin: 10px;
            min-width: 200px;
        }

        .button:hover {
            transform: translateY(-2px);
            box-shadow: 0 10px 20px rgba(102, 126, 234, 0.3);
        }

        .button.secondary {
            background: #e9ecef;
            color: #495057;
        }

        .button.secondary:hover {
            background: #dee2e6;
            box-shadow: 0 5px 15px rgba(0,0,0,0.1);
        }

        .qr-container {
            background: white;
            border: 2px solid #e9ecef;
            border-radius: 15px;
            padding: 20px;
            margin: 20px 0;
        }

        .qr-code {
            width: 200px;
            height: 200px;
            background: #f8f9fa;
            border: 2px dashed #dee2e6;
            border-radius: 10px;
            display: flex;
            align-items: center;
            justify-content: center;
            margin: 0 auto 15px;
            font-size: 14px;
            color: #666;
        }

        .qr-actual {
            width: 180px;
            height: 180px;
            background: white;
            border: 1px solid #ddd;
            display: flex;
            align-items: center;
            justify-content: center;
            font-size: 12px;
            color: #333;
        }

        .group-info {
            background: #e3f2fd;
            border-radius: 10px;
            padding: 15px;
            margin: 15px 0;
        }

        .member-list {
            text-align: left;
            margin: 15px 0;
        }

        .member {
            display: flex;
            align-items: center;
            padding: 10px;
            background: #f8f9fa;
            border-radius: 8px;
            margin: 5px 0;
        }

        .member-status {
            width: 12px;
            height: 12px;
            border-radius: 50%;
            margin-right: 10px;
        }

        .status-waiting { background: #ffc107; }
        .status-ready { background: #28a745; }
        .status-seated { background: #17a2b8; }

        .notification {
            position: fixed;
            top: 20px;
            right: 20px;
            background: #28a745;
            color: white;
            padding: 15px 20px;
            border-radius: 10px;
            box-shadow: 0 5px 15px rgba(0,0,0,0.3);
            transform: translateX(400px);
            transition: transform 0.3s ease;
            z-index: 1000;
        }

        .notification.show {
            transform: translateX(0);
        }

        .seat-info {
            background: #d4edda;
            border: 1px solid #c3e6cb;
            border-radius: 10px;
            padding: 20px;
            margin: 20px 0;
        }

        .seat-info h3 {
            color: #155724;
            margin-bottom: 10px;
        }

        .nfc-simulation {
            background: #fff3cd;
            border: 1px solid #ffeaa7;
            border-radius: 10px;
            padding: 15px;
            margin: 15px 0;
            font-size: 14px;
            color: #856404;
        }

        .hidden {
            display: none;
        }

        .input-group {
            margin: 15px 0;
        }

        .input-group input {
            width: 100%;
            padding: 12px;
            border: 2px solid #e9ecef;
            border-radius: 8px;
            font-size: 16px;
            margin-bottom: 10px;
        }

        .input-group input:focus {
            outline: none;
            border-color: #667eea;
        }
    </style>
</head>
<body>
    <div class="container">
        <div class="header">
            <h1>🍽️ 食堂合流アプリ</h1>
            <p>効率的にグループで食事を楽しもう</p>
        </div>

        <!-- 初期画面 -->
        <div id="initial-screen">
            <div class="status">
                <h2>開始方法を選択</h2>
                <p>新しいグループを作成するか、既存のグループに参加してください</p>
            </div>
            <button class="button" onclick="createGroup()">新しいグループを作成</button>
            <button class="button secondary" onclick="showJoinForm()">グループに参加</button>
            
            <div id="join-form" class="hidden">
                <div class="input-group">
                    <input type="text" id="group-code" placeholder="グループコードを入力" maxlength="6">
                    <button class="button" onclick="joinGroup()">参加</button>
                </div>
            </div>
        </div>

        <!-- NFC シミュレーション画面 -->
        <div id="nfc-screen" class="hidden">
            <div class="status">
                <h2>📱 NFCタグにタッチ</h2>
                <p>メニュー前のNFCタグにスマホをタッチしてください</p>
            </div>
            <div class="nfc-simulation">
                <p>💡 実際の環境では、NFCタグにタッチするとグループが自動作成されます</p>
            </div>
            <button class="button" onclick="simulateNFC()">NFCタッチをシミュレート</button>
        </div>

        <!-- グループ作成画面 -->
        <div id="leader-screen" class="hidden">
            <div class="status">
                <h2>👑 グループリーダー</h2>
                <p>QRコードをメンバーに共有してください</p>
            </div>
            <div class="qr-container">
                <div class="qr-code">
                    <div class="qr-actual" id="qr-display">
                        QRコードが生成されます
                    </div>
                </div>
                <p><strong>グループコード: <span id="group-code-display"></span></strong></p>
            </div>
            <div class="group-info">
                <h3>👥 参加メンバー (<span id="member-count">1</span>人)</h3>
                <div class="member-list" id="member-list"></div>
            </div>
            <button class="button secondary" onclick="checkSeatAvailability()">席の確保状況を確認</button>
        </div>

        <!-- メンバー画面 -->
        <div id="member-screen" class="hidden">
            <div class="status">
                <h2>👤 グループメンバー</h2>
                <p>料理を受け取ったら「受け取り完了」を押してください</p>
            </div>
            <div class="group-info">
                <h3>グループコード: <span id="member-group-code"></span></h3>
                <p>リーダー: <span id="leader-name"></span></p>
            </div>
            <div class="member-list" id="member-status-list"></div>
            <button class="button" onclick="markReady()" id="ready-button">料理受け取り完了</button>
            <button class="button secondary" onclick="secureSeat()" id="seat-button" disabled>席を確保する</button>
        </div>

        <!-- 席確保画面 -->
        <div id="seat-screen" class="hidden">
            <div class="status">
                <h2>🪑 席の確保</h2>
                <p>空いている席を見つけてNFCタグにタッチしてください</p>
            </div>
            <div class="nfc-simulation">
                <select id="seat-select">
                    <option value="">席を選択してください</option>
                    <option value="A-1">テーブルA-1 (窓際)</option>
                    <option value="B-3">テーブルB-3 (中央)</option>
                    <option value="C-2">テーブルC-2 (奥)</option>
                    <option value="D-4">テーブルD-4 (入口近く)</option>
                </select>
            </div>
            <button class="button" onclick="confirmSeat()">この席を確保</button>
        </div>

        <!-- 合流完了画面 -->
        <div id="meeting-screen" class="hidden">
            <div class="seat-info">
                <h3>🎉 合流場所が決定！</h3>
                <p><strong>席: <span id="meeting-location"></span></strong></p>
                <p>確保者: <span id="seat-holder"></span></p>
            </div>
            <div class="member-list" id="final-member-list"></div>
            <button class="button secondary" onclick="resetApp()">新しいグループを作成</button>
        </div>
    </div>

    <!-- 通知 -->
    <div id="notification" class="notification">
        <p id="notification-text"></p>
    </div>

    <script>
        // アプリケーションの状態管理
        let appState = {
            currentScreen: 'initial',
            userRole: null, // 'leader' or 'member'
            groupCode: null,
            userName: null,
            members: [],
            seatLocation: null,
            seatHolder: null
        };

        // ユーザー名をランダム生成（実際の実装では認証システムを使用）
        function generateUserName() {
            const names = ['田中', '佐藤', '鈴木', '高橋', '伊藤', '渡辺', '山本', '中村'];
            const firstNames = ['太郎', '花子', '次郎', '美咲', '健太', '由美', '翔太', '綾香'];
            return names[Math.floor(Math.random() * names.length)] + 
                   firstNames[Math.floor(Math.random() * firstNames.length)];
        }

        // グループコード生成
        function generateGroupCode() {
            return Math.random().toString(36).substring(2, 8).toUpperCase();
        }

        // 画面切り替え
        function showScreen(screenId) {
            document.querySelectorAll('.container > div').forEach(div => {
                if (div.id && div.id.includes('-screen')) {
                    div.classList.add('hidden');
                }
            });
            document.getElementById('initial-screen').classList.add('hidden');
            document.getElementById(screenId).classList.remove('hidden');
            appState.currentScreen = screenId;
        }

        // 通知表示
        function showNotification(message) {
            const notification = document.getElementById('notification');
            const text = document.getElementById('notification-text');
            text.textContent = message;
            notification.classList.add('show');
            setTimeout(() => {
                notification.classList.remove('show');
            }, 3000);
        }

        // グループ作成
        function createGroup() {
            showScreen('nfc-screen');
        }

        // NFC シミュレーション
        function simulateNFC() {
            appState.userRole = 'leader';
            appState.groupCode = generateGroupCode();
            appState.userName = generateUserName();
            appState.members = [{
                name: appState.userName,
                status: 'waiting',
                isLeader: true
            }];

            showScreen('leader-screen');
            updateLeaderScreen();
            showNotification('NFCタッチ成功！グループが作成されました');
        }

        // リーダー画面更新
        function updateLeaderScreen() {
            document.getElementById('group-code-display').textContent = appState.groupCode;
            document.getElementById('member-count').textContent = appState.members.length;
            
            // QRコード表示（実際の実装ではQRコードライブラリを使用）
            document.getElementById('qr-display').innerHTML = `
                <div style="font-size: 10px; line-height: 1.2;">
                    グループコード<br>
                    <strong style="font-size: 16px;">${appState.groupCode}</strong><br>
                    <small>実際はQRコード</small>
                </div>
            `;

            updateMemberList('member-list');
        }

        // 参加フォーム表示
        function showJoinForm() {
            document.getElementById('join-form').classList.remove('hidden');
        }

        // グループ参加
        function joinGroup() {
            const code = document.getElementById('group-code').value.toUpperCase();
            if (code.length !== 6) {
                alert('正しいグループコードを入力してください');
                return;
            }

            appState.userRole = 'member';
            appState.groupCode = code;
            appState.userName = generateUserName();
            
            // 実際の実装では、サーバーからグループ情報を取得
            appState.members = [
                { name: '田中太郎', status: 'waiting', isLeader: true },
                { name: appState.userName, status: 'waiting', isLeader: false }
            ];

            showScreen('member-screen');
            updateMemberScreen();
            showNotification(`グループ ${code} に参加しました`);
        }

        // メンバー画面更新
        function updateMemberScreen() {
            document.getElementById('member-group-code').textContent = appState.groupCode;
            document.getElementById('leader-name').textContent = 
                appState.members.find(m => m.isLeader)?.name || '不明';
            updateMemberList('member-status-list');
        }

        // メンバーリスト更新
        function updateMemberList(containerId) {
            const container = document.getElementById(containerId);
            container.innerHTML = '';
            
            appState.members.forEach(member => {
                const memberDiv = document.createElement('div');
                memberDiv.className = 'member';
                
                const statusClass = `status-${member.status}`;
                const statusText = {
                    'waiting': '待機中',
                    'ready': '準備完了',
                    'seated': '着席済み'
                }[member.status];

                memberDiv.innerHTML = `
                    <div class="member-status ${statusClass}"></div>
                    <span>${member.name} ${member.isLeader ? '👑' : ''}</span>
                    <span style="margin-left: auto; font-size: 12px; color: #666;">${statusText}</span>
                `;
                container.appendChild(memberDiv);
            });
        }

        // 料理受け取り完了
        function markReady() {
            const memberIndex = appState.members.findIndex(m => m.name === appState.userName);
            if (memberIndex !== -1) {
                appState.members[memberIndex].status = 'ready';
                document.getElementById('ready-button').disabled = true;
                document.getElementById('ready-button').textContent = '受け取り完了済み';
                document.getElementById('seat-button').disabled = false;
                updateMemberList('member-status-list');
                showNotification('料理の受け取りが完了しました');
            }
        }

        // 席確保
        function secureSeat() {
            showScreen('seat-screen');
        }

        // 席確保確認
        function confirmSeat() {
            const selectedSeat = document.getElementById('seat-select').value;
            if (!selectedSeat) {
                alert('席を選択してください');
                return;
            }

            appState.seatLocation = selectedSeat;
            appState.seatHolder = appState.userName;

            // 自分の状態を着席済みに更新
            const memberIndex = appState.members.findIndex(m => m.name === appState.userName);
            if (memberIndex !== -1) {
                appState.members[memberIndex].status = 'seated';
            }

            showScreen('meeting-screen');
            updateMeetingScreen();
            showNotification(`席 ${selectedSeat} を確保しました！`);
        }

        // 合流画面更新
        function updateMeetingScreen() {
            document.getElementById('meeting-location').textContent = appState.seatLocation;
            document.getElementById('seat-holder').textContent = appState.seatHolder;
            updateMemberList('final-member-list');
        }

        // 席の確保状況確認
        function checkSeatAvailability() {
            alert('現在の状況:\n準備完了: ' + 
                appState.members.filter(m => m.status === 'ready').length + '人\n' +
                '着席済み: ' + appState.members.filter(m => m.status === 'seated').length + '人');
        }

        // アプリリセット
        function resetApp() {
            appState = {
                currentScreen: 'initial',
                userRole: null,
                groupCode: null,
                userName: null,
                members: [],
                seatLocation: null,
                seatHolder: null
            };
            
            showScreen('initial-screen');
            document.getElementById('join-form').classList.add('hidden');
            document.getElementById('group-code').value = '';
            document.getElementById('ready-button').disabled = false;
            document.getElementById('ready-button').textContent = '料理受け取り完了';
            document.getElementById('seat-button').disabled = true;
        }

        // 初期化
        document.addEventListener('DOMContentLoaded', function() {
            showScreen('initial-screen');
        });

        // 定期的にメンバー状態を更新（実際の実装ではWebSocketやServer-Sent Eventsを使用）
        setInterval(() => {
            if (appState.members.length > 1) {
                // ランダムにメンバーの状態を更新（デモンストレーション用）
                appState.members.forEach(member => {
                    if (member.name !== appState.userName && Math.random() < 0.1) {
                        if (member.status === 'waiting') member.status = 'ready';
                        else if (member.status === 'ready' && Math.random() < 0.3) member.status = 'seated';
                    }
                });
                
                if (appState.currentScreen === 'leader-screen') {
                    updateMemberList('member-list');
                } else if (appState.currentScreen === 'member-screen') {
                    updateMemberList('member-status-list');
                }
            }
        }, 3000);
    </script>
</body>
</html>